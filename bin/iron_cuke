#!/usr/bin/env ruby
$: << File.dirname(__FILE__)+'/../lib'
require 'silverware'

# configliere
Settings.use :commandline
Settings({
  homebase_dir: Dir.pwd,
  node: '*',
})
Settings.define :homebase_dir, flag: 'd', description: 'Directory of the Chef homebase'
Settings.define :node, description: 'Description of chef node(s) to test'
Settings.resolve!

if Settings.rest.length == 1
  Settings[:node] = Settings.rest[0]
end

Dir.chdir(Settings[:homebase_dir])
puts "Getting Chef data..."
JSON.create_id = nil
json = JSON.parse(`knife search node -f json "name:#{Settings[:node]}"`)

if json['results'] == 0
  puts "Chef search returned no results. Exiting..."
  exit
end

json['rows'].each do |row|

